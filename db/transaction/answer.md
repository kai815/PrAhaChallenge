## 課題１（質問）

### デッドロック

複数の処理が互いにロック解除待ちになってしまい、どちらも処理を実行できなくなることです。

### それぞれの ISOLATION LEVEL について

データベースで使用される分離レベル（ISOLATION LEVEL）によって、データの一貫性に関連する、次の事象がトランザクションで発生するかどうかが決まります。

① ダーティリードとは、トランザクション B でコミットされていないデータをトランザクション A で読み取ってしまう問題が起きます。
② ファジーリードとは、トランザクション A でデータを複数回読み取っている途中で、トランザクション B でデータを更新してコミットした場合、トランザクション A で違う結果のデータを読み取ってしまう問題が起きます。(非再現リードとも呼ぶ)
③ ファントムリードとは、トランザクション A で一定の範囲のレコードに対して処理を行っている途中で、トランザクション B でデータを追加・削除してコミットした場合、トランザクション A で幻影のようにデータが反映されるため、処理の結果が変わってしまう問題が起きます。

#### READ UNCOMMITTED（コミットされていない読み取り）

①、②、③ の問題が起きます。

#### READ COMMITTED（コミットされた読み取り）

②、③ の問題が起きます。

#### REPEATABLE READ（反復可能な読み取り）

③ の問題が起きます。

#### SERIALIZABLE（直列化可能）

①、②、③ の問題が起きません。

### 行レベルのロック、テーブルレベルのロックの違い

行ロック：対象のデータ行のみをロック
テーブルロック：テーブル全体をロック
します。

### 悲観ロックと楽観ロックの違い

楽観ロックとは、めったなことでは他者との同時更新は起きないであろう、という楽観的な前提の排他制御。データそのものに対してロックは行わずに、更新対象のデータがデータ取得時と同じ状態であることを確認してから更新することで、データの整合性を保証する方式。楽観ロックを使用する場合は、更新対象のデータがデータ取得時と同じ状態であることを判断するために、Version を管理するためのカラム(Version カラム)を用意する。更新時の条件として、データ取得時の Version とデータ更新時の Version を同じとすることで、データの整合性を保証することができる。

悲観ロックとは、他者が同じデータに頻繁に変更を加えるであろう、という悲観的な前提の排他制御。更新対象のデータを取得する際にロックをかけることで、他のトランザクションから更新されないようにする方式。悲観ロックを使用する場合は、トランザクション開始直後に更新対象となるレコードのロックを取得する。ロックされたレコードは、トランザクションが、コミットまたはロールバックされるまで、他のトランザクションから更新されないため、データの整合性を保証することができる。
